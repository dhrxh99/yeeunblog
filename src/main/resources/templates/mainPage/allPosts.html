<!-- src/main/resources/templates/allPosts.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>전체 게시글</title>
    <style>
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
        .toolbar { display:flex; gap:12px; align-items:center; margin-bottom:16px; }
        .pill { padding:6px 12px; border:1px solid #ccc; border-radius:999px; text-decoration:none; color:#333; }
        .pill.active { background:#333; color:#fff; border-color:#333; }
        .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap:16px; }
        .card { display:flex; gap:12px; border:1px solid #eee; border-radius:12px; padding:12px; background:#fff; }
        .thumb { width:120px; height:80px; border-radius:8px; object-fit:cover; background:#f2f2f2; flex-shrink:0; }
        .meta { color:#666; font-size:12px; margin-top:4px; display:flex; gap:10px; flex-wrap:wrap; }
        .title { margin:0; font-size:16px; line-height:1.3; }
        .excerpt { margin:6px 0 0 0; color:#444; font-size:13px; line-height:1.5; max-height:3.1em; overflow:hidden; }
        .badge { display:inline-block; font-size:11px; padding:2px 8px; border-radius:999px; background:#f1f3f5; color:#555; }
        .empty { text-align:center; color:#888; padding:40px 0; }
        .pager { display:flex; gap:12px; justify-content:center; align-items:center; margin-top:20px; }
        .pager a { text-decoration:none; color:#333; border:1px solid #ddd; padding:6px 10px; border-radius:6px; }
        .spacer { flex:1; }
    </style>
</head>
<body>

<header class="toolbar">
    <h2 style="margin:0;">전체 게시글</h2>
    <span class="spacer"></span>

    <!-- 정렬 토글: latest / views -->
    <a class="pill"
       th:href="@{/all-posts(page=0, size=10, sort='latest')}"
       th:classappend="${sort}=='latest' ? ' active' : ''">최신순</a>

    <a class="pill"
       th:href="@{/all-posts(page=0, size=10, sort='views')}"
       th:classappend="${sort}=='views' ? ' active' : ''">조회수순</a>
</header>

<section th:if="${#lists.isEmpty(posts)}" class="empty">
    아직 게시글이 없습니다.
</section>

<section th:unless="${#lists.isEmpty(posts)}" class="grid">
    <!-- 카드 반복 -->
    <article class="card" th:each="post : ${posts}">
        <!-- 썸네일: post.thumbnailUrl 있으면 표시, 없으면 기본 플레이스홀더 -->
        <img class="thumb"
             th:if="${post.thumbnailUrl} != null"
             th:src="${post.thumbnailUrl}"
             alt="thumbnail" />
        <div th:if="${post.thumbnailUrl} == null" class="thumb"
             style="display:flex;align-items:center;justify-content:center;color:#aaa;font-size:12px;">
            NO IMAGE
        </div>

        <div>
            <a th:href="@{'/post/' + ${post.id}}" style="text-decoration:none;color:inherit;">
                <h3 class="title" th:text="${post.title}">제목</h3>
            </a>

            <div class="meta">
                <span class="badge" th:text="${post.category}">category</span>
                <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">2025-01-01 12:00</span>
                <span th:text="'조회 ' + ${post.viewCount}">조회 0</span>
            </div>

            <!-- 간단한 발췌: content 앞부분 100자 정도 -->
            <p class="excerpt"
               th:text="${#strings.length(post.content) > 100 ? #strings.substring(post.content,0,100) + '…' : post.content}">
                글 요약이 여기에 표시됩니다…
            </p>
        </div>
    </article>
</section>

<!-- 페이지네이션: sort 파라미터 유지 -->
<nav class="pager" th:if="${totalPages > 0}">
    <a th:if="${currentPage > 0}"
       th:href="@{/all-posts(page=${currentPage - 1}, size=10, sort=${sort})}">◀ 이전</a>

    <span>페이지 <span th:text="${currentPage + 1}">1</span> / <span th:text="${totalPages}">1</span></span>

    <a th:if="${currentPage + 1 < totalPages}"
       th:href="@{/all-posts(page=${currentPage + 1}, size=10, sort=${sort})}">다음 ▶</a>
</nav>

<!-- 홈으로 -->
<div style="margin-top:20px;">
    <a th:href="@{/}">← 홈으로</a>
</div>

</body>
</html>
